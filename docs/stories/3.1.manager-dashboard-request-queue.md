# Story 3.1: Manager Dashboard & Request Queue

## Status
Approved

## Story
**As a** manager,
**I want** to view all pending travel requests assigned to me with employee context,
**so that** I can efficiently review and prioritize requests requiring my approval.

## Acceptance Criteria
1. Manager dashboard displays pending requests in a prioritized table with columns for employee name, project, subproject, requested days, calculated allowance, and submission date
2. Employee context panel shows employee details, current total weekly allowances, and request history when selecting a request
3. Request filtering capabilities allow searching by employee name, project, date range, and allowance amount ranges
4. Sorting functionality enables ordering by submission date, allowance amount, employee name, or urgency indicators
5. Pagination handles large volumes of requests with configurable page sizes (10, 25, 50 requests per page)
6. Dashboard auto-refreshes every 2 minutes to show new requests without manual page refresh
7. Visual indicators highlight urgent requests or those approaching approval deadlines

## Tasks / Subtasks
- [ ] Create manager dashboard Angular component (AC: 1)
  - [ ] Design manager-specific dashboard layout with Angular Material table
  - [ ] Implement data service for fetching manager's pending requests
  - [ ] Create responsive table with columns for employee, project, allowance, date
  - [ ] Add priority indicators and urgency visual cues
  - [ ] Implement loading states and error handling for dashboard data

- [ ] Build employee context panel (AC: 2)
  - [ ] Create expandable or side panel for employee details
  - [ ] Display employee profile information and contact details
  - [ ] Show current total weekly allowances across all active requests
  - [ ] Add employee request history timeline with status indicators
  - [ ] Implement lazy loading for employee context data

- [ ] Add comprehensive filtering capabilities (AC: 3)
  - [ ] Create search input for employee name with autocomplete
  - [ ] Add project/subproject filter dropdowns
  - [ ] Implement date range picker for submission date filtering
  - [ ] Add allowance amount range slider or input controls
  - [ ] Create filter combination logic with proper query handling

- [ ] Implement table sorting functionality (AC: 4)
  - [ ] Add sortable column headers for all key fields
  - [ ] Implement submission date sorting (newest/oldest first)
  - [ ] Add allowance amount sorting (highest/lowest first)
  - [ ] Create employee name alphabetical sorting
  - [ ] Add urgency/priority-based sorting with custom logic

- [ ] Add pagination and data management (AC: 5)
  - [ ] Implement pagination with configurable page sizes
  - [ ] Create page size selector (10, 25, 50 requests)
  - [ ] Add total count display and page navigation
  - [ ] Implement efficient data loading for large result sets
  - [ ] Add URL state management for pagination and filters

- [ ] Implement auto-refresh functionality (AC: 6)
  - [ ] Create automatic refresh every 2 minutes for new requests
  - [ ] Add user notification when new requests appear
  - [ ] Implement smart refresh that preserves user selections
  - [ ] Add manual refresh button for immediate updates
  - [ ] Handle refresh failures gracefully with user feedback

- [ ] Add visual urgency indicators (AC: 7)
  - [ ] Create urgency calculation based on submission date
  - [ ] Add color-coded indicators for urgent requests
  - [ ] Implement deadline tracking and warning system
  - [ ] Create visual hierarchy for request prioritization
  - [ ] Add legend and guidance for urgency indicators

## Dev Notes

### Architecture Context
From the architecture document:
- **Frontend:** Angular 17+ with manager-specific feature module
- **State Management:** NgRx for dashboard state and real-time updates
- **API Integration:** Manager-specific endpoints with role-based authorization
- **Real-time Updates:** Polling or WebSocket for new request notifications

### Manager Workflow Context
From brainstorming session and PRD:
- **Core Workflow:** Manager review â†’ approval/rejection with context
- **Employee Context:** Critical for informed decision-making
- **Batch Processing:** Preparation for bulk approval operations (Story 3.4)
- **Performance:** Handle high volumes during peak submission periods

### Business Requirements
From PRD requirements:
- **Manager Search:** Search and view employee requests with filtering (FR4)
- **Employee Context:** Complete visibility for informed decisions
- **Role-based Access:** Manager-only dashboard with proper security (FR14)
- **Efficient Processing:** Support manager productivity and workflow

### Dashboard Data Model
```typescript
interface ManagerDashboard {
  pendingRequests: TravelRequestSummary[];
  totalPending: number;
  urgentCount: number;
  filters: DashboardFilters;
  employeeContext?: EmployeeContext;
}

interface TravelRequestSummary {
  id: string;
  employeeName: string;
  employeeEmail: string;
  projectName: string;
  subProjectName: string;
  daysPerWeek: number;
  calculatedAllowance: number;
  submittedDate: Date;
  urgencyLevel: 'low' | 'medium' | 'high';
  daysSinceSubmission: number;
}

interface EmployeeContext {
  employee: Employee;
  currentWeeklyAllowance: number;
  activeRequestsCount: number;
  recentHistory: TravelRequest[];
}
```

### Performance Requirements
- **Response Time:** Dashboard load under 500ms (NFR1)
- **Concurrent Users:** Support 100 concurrent managers (NFR9)
- **Auto-refresh:** Efficient polling without impacting performance
- **Large Datasets:** Handle hundreds of pending requests efficiently

### Testing
- **Test Location:** 
  - Frontend: apps/web/src/app/features/manager/components/__tests__/
  - Integration: apps/web/src/app/__tests__/manager-dashboard/
- **Test Standards:** 
  - Angular component testing with manager role simulation
  - Table interaction and filtering functionality testing
- **Testing Frameworks:** 
  - Frontend: Angular Testing Utilities with Jest
  - E2E: Playwright for complete manager workflow testing
- **Specific Requirements:**
  - Test dashboard data loading and error handling
  - Test filtering, sorting, and pagination functionality
  - Test employee context panel and lazy loading
  - Test auto-refresh and real-time updates
  - Test urgency calculations and visual indicators
  - Test role-based access control for manager-only features

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-30 | 1.0 | Initial story creation from PRD Epic 3 | Sarah (PO) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be populated by dev agent*

### Debug Log References
*To be populated by dev agent*

### Completion Notes List
*To be populated by dev agent*

### File List
*To be populated by dev agent*

## QA Results
*Results from QA Agent review will be populated here*