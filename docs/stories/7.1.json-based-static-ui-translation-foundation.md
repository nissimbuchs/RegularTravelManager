# Story 7.1: json-based-static-ui-translation-foundation

## Status
Accepted

## Story
**As a** Swiss business user,
**I want** the core translation infrastructure implemented,
**so that** I have a solid foundation for multilingual support with proper services and language switching capability.

## Acceptance Criteria
1. **Translation Service Architecture**: Implement core TranslationService, TranslationLoader, and enhanced LanguageService for JSON-based runtime translation
2. **JSON Translation Files**: Create hierarchical translation files for all UI text in `/assets/i18n/` (de.json, fr.json, it.json, en.json)
3. **Language Switcher Component**: Implement language switcher with Swiss flag icons and proper language names in main navigation
4. **Browser Language Detection**: Automatic language detection with Swiss locale priority and fallback to English
5. **Persistence**: Language preference stored in localStorage and maintained across sessions
6. **Performance Optimization**: Intelligent caching and lazy loading of translation files

## Technical Implementation Notes
- Uses single application bundle approach (no separate builds per language)
- Implements runtime translation with instant language switching
- Follows hierarchical translation key structure (e.g., 'employee.dashboard.title')
- Browser cache optimization for translation files (1-hour cache-control)
- **Scope**: Pure infrastructure implementation with sample translation keys for testing

## Tasks / Subtasks

- [ ] Task 1: Create Translation Service Architecture (AC: 1)
  - [ ] Implement TranslationService with synchronous translateSync() method
  - [ ] Create TranslationLoaderService for HTTP loading of JSON files
  - [ ] Enhance LanguageService for state management
  - [ ] Add proper TypeScript interfaces for translation parameters

- [ ] Task 2: Create JSON Translation Files (AC: 2)
  - [ ] Create /assets/i18n/ directory structure
  - [ ] Implement en.json with comprehensive base translation keys
  - [ ] Create de.json, fr.json, it.json with initial translations
  - [ ] Establish hierarchical key naming convention
  - [ ] Add proper HTTP cache headers for translation files

- [ ] Task 3: Implement Language Switcher Component (AC: 3)
  - [ ] Create language-switcher component with Swiss flag icons
  - [ ] Add flag SVG assets for DE, FR, IT, EN
  - [ ] Implement dropdown with language names and flags
  - [ ] Integrate with main navigation layout
  - [ ] Add proper accessibility support

- [ ] Task 4: Browser Language Detection (AC: 4)
  - [ ] Implement automatic browser language detection
  - [ ] Add Swiss locale priority (de-CH, fr-CH, it-CH)
  - [ ] Set up fallback chain: browser → Swiss locales → English
  - [ ] Handle unsupported language gracefully

- [ ] Task 5: Language Persistence (AC: 5)
  - [ ] Implement localStorage persistence for user language preference
  - [ ] Maintain language selection across browser sessions
  - [ ] Handle localStorage availability and errors
  - [ ] Sync language state across browser tabs

- [ ] Task 6: Performance Optimization (AC: 6)
  - [ ] Implement intelligent caching for translation files
  - [ ] Add lazy loading for non-active languages
  - [ ] Optimize bundle size with proper tree-shaking
  - [ ] Add performance monitoring for translation loading

## Infrastructure Impact Assessment ⚠️ REQUIRED

### Frontend Changes
- [ ] **New Components/Pages** - Language switcher component
- [ ] **State Management** - New translation services and language state management
- [ ] **Routing** - No routing changes required
- [ ] **API Integration** - No new API endpoints needed

### Backend Changes
- [ ] **New API Endpoints** - None required for static translation
- [ ] **Lambda Functions** - None required for static translation
- [ ] **Database Changes** - None required for static translation
- [ ] **Authentication** - None required

### Infrastructure Changes (AWS CDK)
- [ ] **API Gateway** - None required
- [ ] **Lambda Configuration** - None required
- [ ] **Database** - None required
- [ ] **Environment Variables** - None required
- [ ] **IAM Permissions** - None required
- [ ] **Other AWS Services** - None required

### Development Environment
- [ ] **Docker Services** - None required
- [ ] **LocalStack** - None required
- [ ] **Sample Data** - None required
- [ ] **Environment Setup** - None required

## Dev Notes

### Technical Design Notes

**Translation Architecture Foundation**:
This story establishes the core translation infrastructure using a synchronous JSON-based approach optimized for immediate UI translation access.

**Synchronous Translation Service Implementation**:
```typescript
// Core synchronous translation service
@Injectable({ providedIn: 'root' })
export class TranslationService {
  private translations: Record<string, any> = {};
  private currentLanguageSubject = new BehaviorSubject<SupportedLanguage>('en');
  public currentLanguage$ = this.currentLanguageSubject.asObservable();

  /**
   * Synchronous translation method - core implementation
   * @param key - Translation key (e.g., 'employee.dashboard.title')
   * @param params - Optional parameters for string interpolation
   * @returns Translated string or fallback
   */
  translateSync(key: string, params?: Record<string, any>): string {
    const translation = this.getNestedTranslation(key);
    if (!translation) {
      console.warn(`Translation key not found: ${key}`);
      return key; // Fallback to key
    }
    return params ? this.interpolateParameters(translation, params) : translation;
  }

  setLanguage(language: SupportedLanguage): void {
    this.currentLanguageSubject.next(language);
    this.loadTranslationsForLanguage(language);
  }
}
```

**Template Integration Pattern**:
```typescript
// Component usage with direct synchronous access
export class ExampleComponent {
  constructor(public translationService: TranslationService) {} // PUBLIC injection

  getPageTitle(): string {
    return this.translationService.translateSync('example.title');
  }
}
```

```html
<!-- Template usage with synchronous method calls -->
<h1>{{ translationService.translateSync('example.title') }}</h1>
<button>{{ translationService.translateSync('common.buttons.save') }}</button>
```

**JSON Translation File Structure**:
```json
{
  "common": {
    "buttons": {
      "save": "Save",
      "cancel": "Cancel",
      "submit": "Submit"
    }
  },
  "employee": {
    "dashboard": {
      "title": "Employee Dashboard",
      "welcome": "Welcome, {{name}}"
    }
  }
}
```

### Testing Standards

**Testing Framework and Patterns**:
- **Framework**: Jest + Angular Testing Utilities for unit tests
- **Component Testing**: Focus on synchronous translation integration
- **Service Testing**: Mock TranslationService.translateSync() method
- **Integration Testing**: Language switching with immediate UI updates

**Synchronous Testing Patterns**:
```typescript
// Component testing with synchronous translation
describe('ExampleComponent', () => {
  let component: ExampleComponent;
  let mockTranslationService: jasmine.SpyObj<TranslationService>;

  beforeEach(() => {
    const spy = jasmine.createSpyObj('TranslationService', ['translateSync']);

    TestBed.configureTestingModule({
      declarations: [ExampleComponent],
      providers: [{ provide: TranslationService, useValue: spy }]
    });

    component = TestBed.createComponent(ExampleComponent).componentInstance;
    mockTranslationService = TestBed.inject(TranslationService) as jasmine.SpyObj<TranslationService>;
  });

  it('should return translated text synchronously', () => {
    mockTranslationService.translateSync.and.returnValue('Translated Text');

    const result = component.getPageTitle();

    expect(result).toBe('Translated Text');
    expect(mockTranslationService.translateSync).toHaveBeenCalledWith('example.title');
  });
});
```

## Definition of Done Checklist

### Development Complete
- [ ] All acceptance criteria implemented
- [ ] Code follows synchronous translation architecture patterns
- [ ] Translation infrastructure working with sample keys
- [ ] Language switcher functional with proper Swiss flags
- [ ] Browser language detection working correctly
- [ ] Language persistence across sessions working

### Infrastructure Complete ⚠️ CRITICAL
- [ ] All infrastructure changes implemented: N/A (frontend-only story)
- [ ] CDK diff reviewed and approved: N/A
- [ ] Environment variables configured: N/A
- [ ] IAM permissions validated: N/A
- [ ] API Gateway routes deployed and tested: N/A
- [ ] Lambda functions deployed and tested: N/A
- [ ] Database migrations applied successfully: N/A
- [ ] Infrastructure validation passes: N/A

### Review Ready
- [ ] Translation infrastructure foundation completed
- [ ] Code follows established synchronous patterns and conventions
- [ ] Infrastructure review completed: N/A
- [ ] Documentation updated with translation architecture
- [ ] CLAUDE.md updated if commands changed: No changes required

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-25 | 1.0 | Initial story creation for JSON-based translation foundation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
<!-- Populated by development agent -->

### Debug Log References
<!-- Populated by development agent -->

### Completion Notes List
<!-- Populated by development agent -->

### File List
<!-- Populated by development agent -->

## QA Results
<!-- Results from QA Agent review -->